---
date:
  created: 2024-04-28
categories:
  - Project
draft: true
---
# Raspberry Pi Gatekeeper

Go to
| [\#1](./2024-02-11-backup.md)
| [\#2](./2024-02-18-passwords.md)
| [\#3](./2024-02-25-gmails.md)
| [\#4](./2024-02-26-github.md)
| [\#5](./2024-03-11-mail-plus.md)
| \#6

<!-- more -->

## Fresh OS Install

I first wanted to upgrade my Ubuntu version to 24.04, the latest version. (It was only released a few days ago!) I looked up some tutorials which made it seem easy to update from 22.04, which is what I thought I had. Turns out, I was still running 20.04 on my Pi! So I would need to step through the major versions, and I figured that I would prefer a clean install anyway, since I don't keep any data directly on the Pi.

I downloaded the official Ubuntu Server ARM64 image and created a startup disk on a 64GB MicroSD card, but unfortunately I would get no signal when plugging in the Pi to my monitor. After a few tries, I decided to go the easy route and install the official Raspberry Pi imager. After a single try with using that utility, it worked perfectly.

> **Warning:** If you create a startup disk, you will lose *all* existing data on that drive!

## First-time Setup

### Wifi

There were a few tricky things to set up for the first time: internet access (over wifi) and SSH access. To set up my wifi configuration, I needed to make changes to the netplan configuration file. I think the file could have slightly different names, but every time I've set it up, it was called `50-cloud-init.yaml`.

```shell
sudo nano /etc/netplan/50-cloud-init.yaml
```

While editing the file, I added the lines under `wifis:`

```yaml
network:
    ethernets:
        eth0:
            dhcp4: true
            optional: true
    wifis:
        wlan0:
            dhcp4: true
            access-points:
                "my-wifi-name":
                    password: "my-password"
    version: 2
```

After the file was saved, I ran the following commands. I'm not sure if `generate` is required, but I did it anyway.

```shell
sudo netplan generate
sudo netplan apply
```

To make sure of a successful internet connection, I simply pinged my website:

```shell
ping nicfv.com
```

Now that I had an internet connection running, I checked for any software updates, but surprisingly there were none. Seems like Ubuntu 24.04 ships with all the latest software. Cool!

```shell
sudo apt update
```

### SSH

To update my SSH configuration, I edited the `sshd_config` file:

```shell
sudo nano /etc/ssh/sshd_config
```

There were 2 lines I needed to change in the file:

```
PasswordAuthentication yes
KbdInteractiveAuthentication yes
```

Basically, these lines allow various forms of keyboard interaction for authentication, and specifically allow password authentication. After saving the changes, I needed to restart the SSH service:

```shell
sudo service ssh restart
```

> At this point, if you are following along, it would be a good idea to make a note of your Pi's IP address using the command:
> ```shell
> ip a # make note of the inet address under wlan0
> ```
> I didn't need to do this, since I have configured a static IP in my router settings, *and* I have a subdomain that points directly to that IP.

At this point, I no longer need to have my keyboard or monitor plugged into the Pi, since I can now do everything from my PC through an SSH connection. I did reboot and re-test everything first since I made a lot of changes and wanted to make sure that nothing got corrupted.

```shell
sudo reboot 0
```

### Authorize Key

Now I'm back on my PC. I had already generated an SSH key pair a long time ago with...

```shell
ssh-keygen -t rsa
```

...so I didn't need to redo it. However, I had to remove my Pi's old known host, so I lazily deleted the entire `known_hosts` file. If I don't do this, then I'll get network security errors and it won't allow me to connect.

```shell
rm ~/.ssh/known_hosts
```

> The reprecussions of this is that whenever I connect to a "new" SSH server, I will get a warning saying that the authenticity of the host cannot be established. If you know what you're doing, just answer "yes" to that message and it goes away after that.

I need to copy over my public key to the Pi using this command. It will ask for the server password, since I enabled `PasswordAuthentication` earlier.

```shell
ssh-copy-id ubuntu@192.168.0.123
```

Now, I can finally connect to my Pi through SSH. From here I will disable the authentication methods I enabled [earlier](#ssh).

```shell
ssh ubuntu@192.168.0.123
# Welcome to Ubuntu 24.04 LTS
sudo nano /etc/ssh/sshd_config
sudo service ssh restart
logout
```

### Pretty SSH Command

I lied with a few of my `ssh` commands. I simplified my SSH connection using a (pretty simple) configuration.

```shell
nano ~/.ssh/config
```

```
Host pi
    User ubuntu
    HostName my-server-name.nicfv.com
    Port 123
```

`my-server-name.nicfv.com` contains an `A+` dynamic DNS record that points to my public network address. Thanks, NameCheap! That means that I can use the much shorter and memorable alias to log into my Raspberry Pi.

```shell
ssh pi
```

So clean!